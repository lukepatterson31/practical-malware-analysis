# Static Analysis Techniques

### AV scanning

Run malware through AV scanners, good to check.

### Hashing

Identify malware by it's hash, MD5 or SHA-1 usually.

### Finding Strings

Find strings in executables, discovering clues and human readable text

### Packed and Obfuscated Malware

Detect packers with PEiD (unsupported) or Unpac.me

`upx` is a packing program

### Portable Executable File Format

File format used by Windows executables, object code and DLLs. It's a data structure 
containing the inofmration for the Windows OS loader to manage the wrapped executable code.
PE files begin with a header including information about the code, type of application, 
required library functions and space requirements.

### Linked Libraries

Static (all dependencies included in binary), Runtime (loads dependency on function call)
and Dynamic (loads on program start) libraries.

Some Windows functions allow importing of linked functions not listed in the program's file 
header. The two most common are `LoadLibrary` and `GetProcAddress`. `LdrGetProcAddress` and 
`LdrLoadDll` are also used. `LoadLibrary` and `GetProcAddress` allow a program to access any
function in any library on the system; When these functions are used you can't tell 
statically which funtions are being used by the suspect program.

The PE file header contains information about every library that will be loaded and every 
function that will be used by the program.

**Exploring Dynamically Linked Functions with Dependency Walker**

[Dependency Walker](https://www.dependencywalker.com/) only lists dynamically linked 
functions in an executable.

DW shows the functions of the linked libraries, which can be identified by an ordinal 
or a name. Functions can be imported by name or ordinal and if imported by ordinal the name 
never appears in the original executable.

**Common DLLs**

| DLL          | Description       |
|--------------|-------------------|
| Kernel32.dll | Common DLL that contains core functionality such as access and manipulation of memory, files and hardware |
| Advapi32.dll | Provides access to advanced core Windows components such as the Service Manager and Registry |
| User32.dll   | Contains all the user-interface components such as buttons, scroll bars and components for controlling and responding to user actions |
| Gdi32.dll    | Contains functions for displaying and manipulating graphics |
| Ntdll.dll    | Interface to the Windows kernel. Generally not imported directly by executables, always imported indirectly by Kernel32.dll. Allows functionality not normally available to Windows programs. Some tasks, such as hiding functionality or manipulating processes, will use this interface. |
| WSock32.dll and Ws2_32.dll | Networking DLLs. A program that accesses either of these most likely connects to a network or performs network-related tasks |
| Wininet.dll  | Contains higher-level networking functions that implement protocols such as FTP, HTTP and NTP |

**Function naming conventions**

When evaluating unfamiliar Windows functions, a few naming conventions are worth noting 
because they come up often and might confuse you if you donâ€™t recognize them. For example, 
you will often encounter function names with an Ex suffix, such as CreateWindowEx. When 
Microsoft updates a function and the new function is incompatible with the old one, 
Microsoft continues to support the old function. The new function is given the same name as 
the old function, with an added Ex suffix. Functions that have been significantly updated 
twice have two Ex suffixes in their names.

Many functions that take strings as parameters include an A or a W at the end of their 
names, such as CreateDirectoryW. This letter does not appear in the documentation for the 
function; it simply indicates that the function accepts a string parameter and that there 
are two different versions of the function: one for ASCII strings and one for wide character 
strings. Remember to drop the trailing A or W when searching for the function in the 
Microsoft documentation.

**Imported Functions**

The PE file header includes information about specific functions used by an executable. 
The names of the functions give a good indication of what the program does. Documentation
for the Windows API through MSDN (No longer available?)

**Exported Funtions**


